<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frome Geek Gaming 40K Tables</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1a1a1a;
      color: #f0f0f0;
      text-align: center;
      padding: 20px;
    }

    h1 {
      color: #00ff99;
      margin-bottom: 10px;
    }

    h2.section-title {
      margin-top: 40px;
      font-size: 24px;
      color: #00ccff;
    }

    .tables {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .table {
      background-color: #333;
      border: 2px solid #00ff99;
      padding: 20px;
      width: 200px;
      border-radius: 10px;
    }

    button {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .book-btn {
      background-color: #00ff99;
      color: #000;
    }

    .unbook-btn {
      background-color: #ff4d4d;
      color: #fff;
    }

    input[type="date"], input[type="text"] {
      padding: 10px;
      font-size: 16px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #00ff99;
      background-color: #1a1a1a;
      color: #f0f0f0;
      width: 200px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .booked-by {
      font-size: 0.9em;
      color: #bbb;
      margin-top: 5px;
    }

    .section-wrapper {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h1>Frome Geek Gaming 40K Tables</h1>
  <input type="date" id="bookingDate" />
  <input type="text" id="playerName" placeholder="Enter your name" />

  <div id="tablesContainer"></div>

  <script>
    // âœ… Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBFzGr19X4tIaBCU0SnISUzFSaZPQ5m1_k",
      authDomain: "fgg-table-booking.firebaseapp.com",
      databaseURL: "https://fgg-table-booking-default-rtdb.firebaseio.com",
      projectId: "fgg-table-booking",
      storageBucket: "fgg-table-booking.firebasestorage.app",
      messagingSenderId: "734963630039",
      appId: "1:734963630039:web:836fd3f994377ffd719592",
      measurementId: "G-PQ2V6KG6BE"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tunnelsTables = 6;
    const crownTables = 3;

    let currentDate = getTodayDate();
    let allBookings = {};

    const bookingDateInput = document.getElementById("bookingDate");
    bookingDateInput.value = currentDate;
    bookingDateInput.addEventListener("change", e => {
      currentDate = e.target.value;
      listenForBookings();
    });

    function getTodayDate() {
      const today = new Date();
      return today.toISOString().split("T")[0];
    }

    function getDayName(dateStr) {
      return new Date(dateStr).toLocaleDateString("en-GB", { weekday: "long" });
    }

    function toggleBooking(area, tableIndex) {
      const nameInput = document.getElementById("playerName");
      const name = nameInput.value.trim();
      const tableKey = `${area}_table${tableIndex}`;
      const tableRef = db.ref(`bookings/${currentDate}/${tableKey}`);
      const isBooked = allBookings[tableKey];

      if (isBooked) {
        tableRef.remove();
      } else {
        if (!name) {
          alert("Please enter your name to book a table.");
          return;
        }
        tableRef.set(name);
      }
    }

    function listenForBookings() {
      db.ref(`bookings/${currentDate}`).on("value", snapshot => {
        allBookings = snapshot.val() || {};
        renderTables();
      });
    }

    function renderTables() {
      const container = document.getElementById("tablesContainer");
      container.innerHTML = "";

      const day = getDayName(currentDate);

      // Tunnels â€“ Only on Tuesdays
      if (day === "Tuesday") {
        const section = document.createElement("div");
        section.className = "section-wrapper";
        section.innerHTML = `<h2 class="section-title">The Tunnels</h2>`;
        const tableRow = document.createElement("div");
        tableRow.className = "tables";

        for (let i = 0; i < tunnelsTables; i++) {
          const tableKey = `tunnels_table${i}`;
          const isBooked = allBookings[tableKey];
          const name = isBooked || "";

          const div = document.createElement("div");
          div.className = "table";
          const buttonClass = isBooked ? "unbook-btn" : "book-btn";
          const buttonLabel = isBooked ? "Unbook" : "Book Now";

          div.innerHTML = `
            <h3>Table ${i + 1}</h3>
            <p>Status: ${isBooked ? "Booked" : "Available"}</p>
            ${name ? `<div class="booked-by">Booked by: ${name}</div>` : ""}
            <button class="${buttonClass}" onclick="toggleBooking('tunnels', ${i})">${buttonLabel}</button>
          `;
          tableRow.appendChild(div);
        }

        section.appendChild(tableRow);
        container.appendChild(section);
      }

      // Crown â€“ Only on Mondays
      if (day === "Monday") {
        const section = document.createElement("div");
        section.className = "section-wrapper";
        section.innerHTML = `<h2 class="section-title">The Crown</h2>`;
        const tableRow = document.createElement("div");
        tableRow.className = "tables";

        for (let i = 0; i < crownTables; i++) {
          const tableKey = `crown_table${i}`;
          const isBooked = allBookings[tableKey];
          const name = isBooked || "";

          const div = document.createElement("div");
          div.className = "table";
          const buttonClass = isBooked ? "unbook-btn" : "book-btn";
          const buttonLabel = isBooked ? "Unbook" : "Book Now";

          div.innerHTML = `
            <h3>Table ${i + 1}</h3>
            <p>Status: ${isBooked ? "Booked" : "Available"}</p>
            ${name ? `<div class="booked-by">Booked by: ${name}</div>` : ""}
            <button class="${buttonClass}" onclick="toggleBooking('crown', ${i})">${buttonLabel}</button>
          `;
          tableRow.appendChild(div);
        }

        section.appendChild(tableRow);
        container.appendChild(section);
      }

      if (day !== "Monday" && day !== "Tuesday") {
        container.innerHTML = `<p style="margin-top: 30px;">No tables available for booking on ${day}s.</p>`;
      }
    }

    // Initial load
    listenForBookings();
  </script>

   <!-- ðŸŽ¯ Warhammer 40K Advanced Dice Roller -->
<div style="margin-top: 60px;">
  <h2 style="color: #00ccff;">Warhammer 40K Advanced Dice Roller</h2>

  <input type="number" id="numDice" placeholder="Number of Dice" min="1" style="margin: 5px; width: 160px;" />
  <input type="number" id="modifier" placeholder="Modifier (+/-)" style="margin: 5px; width: 160px;" />
  <input type="number" id="target" placeholder="Target Number (e.g. 3+)" min="2" max="6" style="margin: 5px; width: 160px;" />
  <input type="number" id="sustained" placeholder="Sustained Hits (on 6s)" min="0" style="margin: 5px; width: 160px;" />

  <br />
  <label><input type="checkbox" id="rerollOnes" style="margin-right: 5px;" />Reroll 1s</label>
  <label><input type="checkbox" id="lethalHits" style="margin-left: 15px; margin-right: 5px;" />Lethal Hits</label>
  <label><input type="checkbox" id="devWounds" style="margin-left: 15px; margin-right: 5px;" />Devastating Wounds</label>

  <br />
  <button onclick="rollAdvancedDice()" style="margin: 15px; padding: 10px 20px; font-weight: bold; border-radius: 5px; background-color: #00ccff; color: #000;">Roll</button>

  <div id="whDiceResults" style="margin-top: 20px; font-size: 16px;"></div>
</div>

<script>
  function rollAdvancedDice() {
    const numDice = parseInt(document.getElementById("numDice").value);
    const modifier = parseInt(document.getElementById("modifier").value) || 0;
    const target = parseInt(document.getElementById("target").value);
    const sustainedHits = parseInt(document.getElementById("sustained").value) || 0;
    const rerollOnes = document.getElementById("rerollOnes").checked;
    const lethalHits = document.getElementById("lethalHits").checked;
    const devWounds = document.getElementById("devWounds").checked;

    const resultDiv = document.getElementById("whDiceResults");
    resultDiv.innerHTML = "";

    if (isNaN(numDice) || numDice <= 0 || numDice > 500) {
      resultDiv.innerHTML = "<p>Please enter a valid number of dice (1â€“500).</p>";
      return;
    }

    if (isNaN(target) || target < 2 || target > 6) {
      resultDiv.innerHTML = "<p>Please enter a valid target number (2â€“6).</p>";
      return;
    }

    let rolls = [];
    let hits = 0;
    let extraHits = 0;
    let lethalWounds = 0;
    let mortalWounds = 0;
    let rerolled = 0;

    for (let i = 0; i < numDice; i++) {
      let raw = Math.floor(Math.random() * 6) + 1;

      // Reroll 1s
      if (rerollOnes && raw === 1) {
        raw = Math.floor(Math.random() * 6) + 1;
        rerolled++;
      }

      const modified = raw + modifier;

      // Lethal Hits
      if (raw === 6 && lethalHits) {
        lethalWounds++;
        if (devWounds) mortalWounds++;
        continue; // skip hit check
      }

      if (modified >= target) {
        hits++;
      }

      if (raw === 6 && sustainedHits > 0) {
        extraHits += sustainedHits;
      }

      rolls.push({ raw, modified });
    }

    const totalHits = hits + extraHits;
    const totalWounds = lethalWounds + totalHits;

    resultDiv.innerHTML = `
      <p><strong>Rolls:</strong> ${rolls.map(r => r.raw + (modifier ? `(+${modifier}) â†’ ${r.modified}` : '')).join(", ")}</p>
      ${rerolled > 0 ? `<p><strong>Rerolled 1s:</strong> ${rerolled}</p>` : ""}
      <p><strong>Normal Hits:</strong> ${hits}</p>
      <p><strong>Sustained Hits (extra):</strong> ${extraHits}</p>
      <p><strong>Lethal Hits (auto-wounds):</strong> ${lethalWounds}</p>
      ${mortalWounds > 0 ? `<p><strong>Devastating Wounds (mortal wounds):</strong> ${mortalWounds}</p>` : ""}
      <p><strong>Total Hits/Wounds:</strong> ${totalWounds}</p>
    `;
  }
</script>
  
</body>
</html>
